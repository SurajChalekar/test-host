import{_ as De,r as v,c as we,w as Oe,o as Ue,a as k,b as g,e as n,f as m,F as Ae,h as Ve,n as B,g as M,t as me}from"./index-BdV1KZIb.js";const He={class:"puzzles-page"},Ie={class:"puzzle-content"},Ge={class:"puzzle-container"},je={class:"puzzle-layout"},Xe={class:"chess-container"},Ye={class:"board-wrapper"},Ze={class:"chess-board",ref:"chessBoard"},Je=["onClick"],es=["data-piece"],ss={key:1,class:"move-indicator"},ts={class:"controls-card"},as={key:0,class:"status-message"},os={class:"controls-sidebar"},ls={class:"puzzle-info-card"},ns={class:"puzzle-title"},us={class:"control-buttons-vertical"},is={key:0,class:"promotion-dialog-overlay"},cs={class:"promotion-dialog"},rs={class:"promotion-pieces"},vs={key:1,class:"game-end-overlay"},fs={class:"game-end-dialog"},ps={class:"game-end-icon"},ds={key:0,class:"fas fa-trophy"},hs={key:1,class:"fas fa-handshake"},ks={class:"game-end-title"},gs={key:0},bs={key:1},ws={class:"game-end-subtitle"},ms={key:0},Cs={key:1},zs={key:2},Ms={__name:"Puzzles",setup(Ps){const P=v(0),j=v(0),R=v(null),f=v(""),p=v(""),d=v(""),C=v("white"),N=v([]),ae=v([]),T=v(!0),X=v(!1),Y=v(!1),_=v(!1),F=v(!1),W=v(null),z=v(null),Q=v(!1),E=v(null),y=v(null),S=v(0),Ce=()=>{S.value=0};we(()=>A.value?.solution||[]);const ze=(s,e)=>{const t=A.value;if(!t||!t.solution||t.solution.length===0)return;const a=t.solution;if(S.value>=a.length)return;const o=a[S.value];if(Le(s,e)===o)if(f.value="âœ… Correct move!",p.value="alert-success",d.value="fas fa-check-circle",S.value++,S.value<a.length){const i=a[S.value],[u,r]=$e(i);setTimeout(()=>{he(u,r,!0),S.value++,C.value="white",S.value>=a.length&&setTimeout(()=>{I()},500)},400)}else setTimeout(()=>{I()},500);else f.value=`âŒ Wrong move! Expected ${o}`,p.value="alert-danger",d.value="fas fa-ban"},w=v({whiteKingMoved:!1,blackKingMoved:!1,whiteKingsideRookMoved:!1,whiteQueensideRookMoved:!1,blackKingsideRookMoved:!1,blackQueensideRookMoved:!1}),K=v([]),c=v([]),A=we(()=>!K.value||K.value.length===0?null:K.value[P.value]||K.value[0]),Me=s=>{const e=[],t=s.split(" ")[0].split("/");for(let a of t)for(let o of a)if(isNaN(o))e.push(o);else for(let l=0;l<parseInt(o);l++)e.push("");return e},D=()=>{const s=A.value;if(s){c.value=[];for(let e=0;e<64;e++)c.value.push({piece:s.board[e]||null,selected:!1});console.log(s),C.value="white",N.value=[],ae.value=[],T.value=!0,X.value=!1,Y.value=!1,_.value=!1,F.value=!1,W.value=null,z.value=null,Q.value=!1,E.value=null,y.value=null,w.value={whiteKingMoved:!1,blackKingMoved:!1,whiteKingsideRookMoved:!1,whiteQueensideRookMoved:!1,blackKingsideRookMoved:!1,blackQueensideRookMoved:!1},Ce()}};Oe(K,s=>{s.length>0&&D()});const Pe=async()=>{const a=(await(await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQyFaAasaUsySp8rSfkT_zmqo4fKdxYc8Fi7WZeIbpRvRGT2aiNM5rNepOy9rWHjzL0xvzNUz2gfrXo/pub?output=csv")).text()).split(`
`).map(l=>l.split(",")),o=a[0];K.value=a.slice(1).map(l=>{let i={};return o.forEach((u,r)=>i[u.trim()]=l[r]?.trim()),i.board=Me(i.fen),i.solution=i.solution?.split(" ").map(u=>u.trim()),i})},L=s=>s&&s===s.toUpperCase(),Z=s=>s&&s===s.toLowerCase(),oe=s=>s?C.value==="white"?L(s):Z(s):!1,O=s=>{const e=Math.floor(s/8),t=s%8;return{row:e,col:t}},h=(s,e)=>s<0||s>7||e<0||e>7?-1:s*8+e,U=s=>c.value[s]&&c.value[s].piece!==null,V=(s,e)=>{const t=c.value[s]?.piece;return t?e?Z(t):L(t):!1},le=(s,e)=>{const t=c.value[s]?.piece;return t?e?L(t):Z(t):!1},Re=s=>{const e=s?"K":"k";for(let t=0;t<64;t++)if(c.value[t]?.piece===e)return t;return-1},ne=(s,e)=>{for(let t=0;t<64;t++){const a=c.value[t]?.piece;if(!a)continue;const o=L(a);if(o!==e)continue;const{row:l,col:i}=O(t);let u=[];switch(a.toLowerCase()){case"p":u.push(...ye(l,i,o));break;case"r":u.push(...J(l,i,o));break;case"n":u.push(...re(l,i,o));break;case"b":u.push(...ee(l,i,o));break;case"q":u.push(...ve(l,i,o));break;case"k":u.push(...fe(l,i,o));break}if(u.some(r=>r.index===s))return!0}return!1},H=s=>{const e=Re(s);return e===-1?!1:ne(e,!s)},_e=s=>{for(let e=0;e<64;e++){const t=c.value[e]?.piece;if(!t||L(t)!==s)continue;if(pe(e).length>0)return!0}return!1},ue=()=>{const s=H(!0),e=H(!1);X.value=s,Y.value=e;const t=C.value==="white";_e(t)?s?(f.value+=" - White King in Check! â™”",p.value="alert-warning",d.value="fas fa-exclamation-triangle"):e&&(f.value+=" - Black King in Check! â™š",p.value="alert-warning",d.value="fas fa-exclamation-triangle"):t&&s?(_.value=!0,W.value="black",T.value=!1,f.value="â™š Checkmate! Black wins!",p.value="alert-danger",d.value="fas fa-trophy"):!t&&e?(_.value=!0,W.value="white",T.value=!1,f.value="â™” Checkmate! White wins!",p.value="alert-danger",d.value="fas fa-trophy"):(F.value=!0,T.value=!1,f.value="ðŸ¤ Stalemate! Draw!",p.value="alert-warning",d.value="fas fa-handshake")},ie=(s,e,t)=>{const a=c.value[s]?.piece,o=c.value[e]?.piece;c.value[s].piece=null,c.value[e].piece=a;const l=H(t);return c.value[s].piece=a,c.value[e].piece=o,l},ye=(s,e,t)=>{const a=[],o=t?-1:1,l=h(s+o,e-1);l!==-1&&a.push({index:l});const i=h(s+o,e+1);return i!==-1&&a.push({index:i}),a},ce=(s,e,t)=>{const{row:a,col:o}=O(s);if(e){if(w.value.whiteKingMoved||t&&w.value.whiteKingsideRookMoved||!t&&w.value.whiteQueensideRookMoved)return!1}else if(w.value.blackKingMoved||t&&w.value.blackKingsideRookMoved||!t&&w.value.blackQueensideRookMoved)return!1;if(a!==(e?7:0)||o!==4)return!1;const u=h(a,t?7:0);if(c.value[u]?.piece!==(e?"R":"r"))return!1;const q=t?5:1,We=t?6:3;for(let x=q;x<=We;x++){const te=h(a,x);if(U(te))return!1}if(H(e))return!1;const Qe=4,Ee=t?6:2,be=t?1:-1;for(let x=Qe;x!==Ee+be;x+=be){const te=h(a,x);if(ne(te,!e))return!1}return!0},Se=(s,e)=>{const t=[],{row:a}=O(s);return ce(s,e,!0)&&t.push({index:h(a,6),isCastling:!0,isKingside:!0}),ce(s,e,!1)&&t.push({index:h(a,2),isCastling:!0,isKingside:!1}),t},Ke=(s,e,t)=>{const a=[],o=t?-1:1,l=t?6:1,i=h(s+o,e);if(i!==-1&&!U(i)&&(a.push({index:i}),s===l)){const b=h(s+o*2,e);b!==-1&&!U(b)&&a.push({index:b,isDoublePawnMove:!0})}const u=h(s+o,e-1);u!==-1&&V(u,t)&&a.push({index:u});const r=h(s+o,e+1);if(r!==-1&&V(r,t)&&a.push({index:r}),z.value!==null){const b=Math.floor(z.value/8),q=z.value%8;s+o===b&&(e-1===q&&a.push({index:z.value,isEnPassant:!0}),e+1===q&&a.push({index:z.value,isEnPassant:!0}))}return a},J=(s,e,t)=>{const a=[],o=[[0,1],[0,-1],[1,0],[-1,0]];for(const[l,i]of o)for(let u=1;u<8;u++){const r=h(s+l*u,e+i*u);if(r===-1)break;if(!U(r))a.push({index:r});else{V(r,t)&&a.push({index:r});break}}return a},re=(s,e,t)=>{const a=[],o=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const[l,i]of o){const u=h(s+l,e+i);u!==-1&&!le(u,t)&&a.push({index:u})}return a},ee=(s,e,t)=>{const a=[],o=[[1,1],[1,-1],[-1,1],[-1,-1]];for(const[l,i]of o)for(let u=1;u<8;u++){const r=h(s+l*u,e+i*u);if(r===-1)break;if(!U(r))a.push({index:r});else{V(r,t)&&a.push({index:r});break}}return a},ve=(s,e,t)=>[...J(s,e,t),...ee(s,e,t)],fe=(s,e,t)=>{const a=[],o=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[l,i]of o){const u=h(s+l,e+i);u!==-1&&!le(u,t)&&a.push({index:u})}return a},pe=s=>{const e=c.value[s]?.piece;if(!e)return[];const{row:t,col:a}=O(s),o=L(e);let l=[];switch(e.toLowerCase()){case"p":l.push(...Ke(t,a,o));break;case"r":l.push(...J(t,a,o));break;case"n":l.push(...re(t,a,o));break;case"b":l.push(...ee(t,a,o));break;case"q":l.push(...ve(t,a,o));break;case"k":l.push(...fe(t,a,o)),l.push(...Se(s,o));break}return l.filter(u=>!ie(s,u.index,o)).filter(u=>u.index>=0&&u.index<64)},de=s=>{const e=pe(s);N.value=e},se=s=>N.value.some(e=>e.index===s),qe=s=>{const e=Math.floor(s/8),t=s%8,a=(e+t)%2===0;let o=["chess-square"];o.push(a?"light-square":"dark-square"),c.value[s].selected&&o.push("selected-square"),se(s)&&o.push("valid-move-square");const l=c.value[s]?.piece;return(l==="K"&&X.value||l==="k"&&Y.value)&&o.push("king-in-check"),o},Be=s=>s?s===s.toUpperCase()?"white-piece":"black-piece":"",Te=(s,e)=>{e==="K"?w.value.whiteKingMoved=!0:e==="k"?w.value.blackKingMoved=!0:e==="R"?(s===63&&(w.value.whiteKingsideRookMoved=!0),s===56&&(w.value.whiteQueensideRookMoved=!0)):e==="r"&&(s===7&&(w.value.blackKingsideRookMoved=!0),s===0&&(w.value.blackQueensideRookMoved=!0))},Le=(s,e)=>{const t="abcdefgh",a=Math.floor(s/8),o=s%8,l=Math.floor(e/8),i=e%8;return`${t[o]}${8-a}${t[i]}${8-l}`},$e=s=>{const e="abcdefgh",t=e.indexOf(s[0]),a=8-parseInt(s[1]),o=e.indexOf(s[2]),l=8-parseInt(s[3]);return[a*8+t,l*8+o]};v(0),v([]);const he=(s,e,t=!1)=>{const a=c.value[s]?.piece;if(!a)return;const o=c.value[e]?.piece,l=L(a);if(!t&&ie(s,e,l)){f.value="âš ï¸ Illegal move! This would leave your king in check.",p.value="alert-danger",d.value="fas fa-ban",$();return}Te(s,a),z.value,z.value=null;const i=N.value.find(r=>r.index===e);if(i?.isEnPassant){const b=e+(l?1:-1)*8;c.value[b].piece=null}if(i?.isCastling){const{row:r}=O(s);if(i.isKingside){const b=h(r,7),q=h(r,5);c.value[q].piece=c.value[b].piece,c.value[b].piece=null}else{const b=h(r,0),q=h(r,3);c.value[q].piece=c.value[b].piece,c.value[b].piece=null}}if(c.value[e].piece=a,c.value[s].piece=null,a.toLowerCase()==="p"&&i?.isDoublePawnMove){const r=l?1:-1;z.value=e+r*8}const u=Math.floor(e/8);if(!t&&a.toLowerCase()==="p"&&(u===0||u===7)){Q.value=!0,E.value=e,y.value=l,T.value=!1,f.value="ðŸ‘‘ Choose a piece for promotion!",p.value="alert-info",d.value="fas fa-crown";return}ae.value.push({from:s,to:e,piece:a,captured:o,turn:C.value,castling:i?.isCastling||!1,enPassant:i?.isEnPassant||!1}),$(),t||(C.value=C.value==="white"?"black":"white"),ue(),t||ze(s,e)},xe=s=>{if(!T.value||Q.value)return;const e=c.value[s];R.value===null?e.piece&&oe(e.piece)?(R.value=s,e.selected=!0,de(s),f.value=`${C.value==="white"?"White":"Black"} to move`,p.value="alert-info",d.value="fas fa-chess"):e.piece&&(f.value=`It's ${C.value}'s turn!`,p.value="alert-warning",d.value="fas fa-exclamation-triangle"):R.value===s?$():se(s)?he(R.value,s):e.piece&&oe(e.piece)?($(),R.value=s,e.selected=!0,de(s)):(f.value="Invalid move! Try again.",p.value="alert-danger",d.value="fas fa-times")},$=()=>{R.value!==null&&(c.value[R.value].selected=!1),R.value=null,N.value=[]},ke=()=>{$(),D(),f.value="Puzzle reset! White to move.",p.value="alert-info",d.value="fas fa-undo"},Fe=()=>{const s=A.value.solution[0];f.value=`Hint: Try ${s}`,p.value="alert-info",d.value="fas fa-lightbulb"},Ne=()=>{f.value="Good move! Keep going...",p.value="alert-success",d.value="fas fa-check-circle"},I=()=>{P.value<K.value.length-1?P.value++:P.value=0,$(),D(),f.value="New puzzle loaded! White to move.",p.value="alert-success",d.value="fas fa-puzzle-piece",j.value++},ge=()=>{P.value>0?P.value--:P.value=K.value.length-1,$(),D(),f.value="Previous puzzle loaded! White to move.",p.value="alert-info",d.value="fas fa-puzzle-piece",j.value>0&&j.value--},G=s=>{if(E.value===null)return;const e=y.value?s.toUpperCase():s.toLowerCase();c.value[E.value].piece=e,Q.value=!1,T.value=!0,f.value=`Pawn promoted to ${s.toUpperCase()}! ðŸ‘‘`,p.value="alert-success",d.value="fas fa-crown",E.value=null,y.value=null,C.value=C.value==="white"?"black":"white",ue()};return Ue(()=>{Pe(),document.title="IISER-TVM Chess Club - Puzzles",D(),f.value="White to move. Select a piece to start!",p.value="alert-info",d.value="fas fa-chess"}),(s,e)=>(g(),k("div",He,[n("section",Ie,[n("div",Ge,[n("div",je,[n("div",Xe,[n("div",Ye,[n("div",Ze,[(g(!0),k(Ae,null,Ve(c.value,(t,a)=>(g(),k("div",{key:a,class:B(qe(a)),onClick:o=>xe(a)},[t.piece?(g(),k("div",{key:0,class:B([Be(t.piece),"chess-piece"]),"data-piece":t.piece},null,10,es)):m("",!0),se(a)?(g(),k("div",ss)):m("",!0)],10,Je))),128))],512)]),n("div",ts,[f.value?(g(),k("div",as,[n("div",{class:B([p.value,"alert"])},[n("i",{class:B([d.value,"me-2"])},null,2),M(me(f.value),1)],2)])):m("",!0),n("div",os,[n("div",ls,[n("h3",ns,[e[5]||(e[5]=n("i",{class:"fas fa-puzzle-piece me-2"},null,-1)),M("Puzzle #"+me(P.value+1),1)])]),e[11]||(e[11]=n("h4",{class:"controls-title"},"Controls",-1)),n("div",us,[n("button",{class:"btn btn-control btn-reset",onClick:ke},[...e[6]||(e[6]=[n("i",{class:"fas fa-undo me-2"},null,-1),M("Reset ",-1)])]),n("button",{class:"btn btn-control btn-hint",onClick:Fe},[...e[7]||(e[7]=[n("i",{class:"fas fa-lightbulb me-2"},null,-1),M("Hint ",-1)])]),n("button",{class:"btn btn-control btn-check",onClick:Ne},[...e[8]||(e[8]=[n("i",{class:"fas fa-check me-2"},null,-1),M("Check Solution ",-1)])]),n("button",{class:"btn btn-control btn-next",onClick:I},[...e[9]||(e[9]=[n("i",{class:"fas fa-arrow-right me-2"},null,-1),M("Next Puzzle ",-1)])]),n("button",{class:"btn btn-control btn-back",onClick:e[0]||(e[0]=(...t)=>ge&&ge(...t))},[...e[10]||(e[10]=[n("i",{class:"fas fa-arrow-left me-2"},null,-1),M("Back ",-1)])])])])])])])]),Q.value?(g(),k("div",is,[n("div",cs,[e[16]||(e[16]=n("h3",{class:"text-center"},"Choose Promotion Piece",-1)),n("div",rs,[n("button",{onClick:e[1]||(e[1]=t=>G("q")),class:"promotion-btn"},[n("div",{class:B([y.value?"white-piece":"black-piece","promotion-piece"])},"â™•",2),e[12]||(e[12]=n("span",null,"Queen",-1))]),n("button",{onClick:e[2]||(e[2]=t=>G("r")),class:"promotion-btn"},[n("div",{class:B([y.value?"white-piece":"black-piece","promotion-piece"])},"â™–",2),e[13]||(e[13]=n("span",null,"Rook",-1))]),n("button",{onClick:e[3]||(e[3]=t=>G("b")),class:"promotion-btn"},[n("div",{class:B([y.value?"white-piece":"black-piece","promotion-piece"])},"â™—",2),e[14]||(e[14]=n("span",null,"Bishop",-1))]),n("button",{onClick:e[4]||(e[4]=t=>G("n")),class:"promotion-btn"},[n("div",{class:B([y.value?"white-piece":"black-piece","promotion-piece"])},"â™˜",2),e[15]||(e[15]=n("span",null,"Knight",-1))])])])])):m("",!0),_.value||F.value?(g(),k("div",vs,[n("div",fs,[n("div",ps,[_.value?(g(),k("i",ds)):m("",!0),F.value?(g(),k("i",hs)):m("",!0)]),n("h2",ks,[_.value?(g(),k("span",gs,"Checkmate!")):m("",!0),F.value?(g(),k("span",bs,"Stalemate!")):m("",!0)]),n("p",ws,[_.value&&W.value==="white"?(g(),k("span",ms,"â™” White Wins!")):m("",!0),_.value&&W.value==="black"?(g(),k("span",Cs,"â™š Black Wins!")):m("",!0),F.value?(g(),k("span",zs,"It's a Draw!")):m("",!0)]),n("div",{class:"game-end-buttons"},[n("button",{onClick:ke,class:"btn btn-light btn-lg"},[...e[17]||(e[17]=[n("i",{class:"fas fa-redo me-2"},null,-1),M("Play Again ",-1)])]),n("button",{onClick:I,class:"btn btn-warning btn-lg"},[...e[18]||(e[18]=[n("i",{class:"fas fa-arrow-right me-2"},null,-1),M("Next Puzzle ",-1)])])])])])):m("",!0)])]))}},_s=De(Ms,[["__scopeId","data-v-eeb25eab"]]);export{_s as default};
